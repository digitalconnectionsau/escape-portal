(()=>{var e={};e.id=412,e.ids=[412],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5285:(e,t,s)=>{Promise.resolve().then(s.bind(s,83606))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14683:(e,t,s)=>{Promise.resolve().then(s.bind(s,38400))},16189:(e,t,s)=>{"use strict";var a=s(65773);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},17472:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,16444,23)),Promise.resolve().then(s.t.bind(s,16042,23)),Promise.resolve().then(s.t.bind(s,88170,23)),Promise.resolve().then(s.t.bind(s,49477,23)),Promise.resolve().then(s.t.bind(s,29345,23)),Promise.resolve().then(s.t.bind(s,12089,23)),Promise.resolve().then(s.t.bind(s,46577,23)),Promise.resolve().then(s.t.bind(s,31307,23))},18973:(e,t,s)=>{Promise.resolve().then(s.bind(s,54582))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},22932:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>r});var a=s(12907);let r=(0,a.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/craigparker/Development/projects/escape_portal/src/context/AuthProvider.tsx","AuthProvider");(0,a.registerClientReference)(function(){throw Error("Attempted to call useAuth() from the server but useAuth is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/craigparker/Development/projects/escape_portal/src/context/AuthProvider.tsx","useAuth")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},38400:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/organisation/[id]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/organisation/[id]/page.tsx","default")},46894:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(60687),r=s(83606);function i({allowedRoles:e,children:t,fallback:s}){let{role:i,loading:n}=(0,r.A)();return n?null:i&&e.includes(i)?(0,a.jsx)(a.Fragment,{children:t}):s||(0,a.jsx)("div",{className:"p-6 text-red-600 font-semibold text-center",children:"You do not have permission to view this content."})}s(43210)},49903:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var a=s(65239),r=s(48088),i=s(88170),n=s.n(i),l=s(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d={children:["",{children:["admin-portal",{children:["organisation",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,38400)),"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/organisation/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,86512)),"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"/Users/craigparker/Development/projects/escape_portal/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/organisation/[id]/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/admin-portal/organisation/[id]/page",pathname:"/admin-portal/organisation/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},54582:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(60687),r=s(85814),i=s.n(r),n=s(16189),l=s(30474),o=s(65553),d=s(62008);function c(){let e=(0,n.usePathname)(),t=(0,n.useRouter)(),s=async()=>{await (0,o.CI)(d.j),t.push("/")},r=(t,s=!1)=>(s?e===t:e.startsWith(t))?"block py-2 px-4 rounded bg-orange-500 text-black font-bold":"block py-2 px-4 rounded hover:bg-orange-400 hover:text-black text-white transition";return(0,a.jsxs)("aside",{className:"w-64 bg-black p-6 min-h-screen flex flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-8 self-center text-center",children:(0,a.jsx)(l.default,{src:"/EPHv1.png",alt:"Escape Portal Logo",width:160,height:60,priority:!0})}),(0,a.jsxs)("nav",{className:"space-y-2",children:[(0,a.jsx)(i(),{href:"/admin-portal",className:r("/admin-portal",!0),children:"Dashboard"}),(0,a.jsx)(i(),{href:"/admin-portal/organisations",className:r("/admin-portal/organisations"),children:"Organisations"}),(0,a.jsx)(i(),{href:"/admin-portal/rounds",className:r("/admin-portal/rounds"),children:"Rounds"}),(0,a.jsx)(i(),{href:"/admin-portal/sessions",className:r("/admin-portal/sessions"),children:"Sessions"}),(0,a.jsx)(i(),{href:"/admin-portal/games",className:r("/admin-portal/games"),children:"Games"}),(0,a.jsx)(i(),{href:"/admin-portal/quizzes",className:r("/admin-portal/quizzes"),children:"Quizzes"}),(0,a.jsx)(i(),{href:"/admin-portal/phishing",className:r("/admin-portal/phishing"),children:"Phishing"}),(0,a.jsx)(i(),{href:"/admin-portal/settings",className:r("/admin-portal/settings"),children:"Settings"})]})]}),(0,a.jsx)("button",{onClick:s,className:"mt-6 w-full py-2 px-4 bg-red-600 hover:bg-red-500 text-white font-semibold rounded transition",children:"Logout"})]})}var u=s(46894);function m({children:e}){return(0,a.jsx)(u.A,{allowedRoles:["super-admin"],children:(0,a.jsxs)("div",{className:"flex min-h-screen bg-black text-white",children:[(0,a.jsx)(c,{}),(0,a.jsx)("main",{className:"flex-1 bg-white text-black p-8",children:e})]})})}},55511:e=>{"use strict";e.exports=require("crypto")},61135:()=>{},62008:(e,t,s)=>{"use strict";s.d(t,{C:()=>c,db:()=>d,j:()=>o});var a=s(67989),r=s(65553),i=s(75535),n=s(24890);let l=(0,a.Wp)({apiKey:"AIzaSyDD6coY49gQGo7rkhcPQY6nUhftziODTPY",authDomain:"escape-portal-au.firebaseapp.com",projectId:"escape-portal-au",storageBucket:"escape-portal-au.firebasestorage.app",messagingSenderId:"917308365081",appId:"1:917308365081:web:1fb93c63b2b43ad9678d88",measurementId:"G-LQ50CD3219"}),o=(0,r.xI)(l),d=(0,i.aU)(l),c=(0,n.Uz)(l,"australia-southeast1")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70440:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(31658);let r=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81024:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,86346,23)),Promise.resolve().then(s.t.bind(s,27924,23)),Promise.resolve().then(s.t.bind(s,35656,23)),Promise.resolve().then(s.t.bind(s,40099,23)),Promise.resolve().then(s.t.bind(s,38243,23)),Promise.resolve().then(s.t.bind(s,28827,23)),Promise.resolve().then(s.t.bind(s,62763,23)),Promise.resolve().then(s.t.bind(s,97173,23))},81630:e=>{"use strict";e.exports=require("http")},83606:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>d});var a=s(60687),r=s(43210),i=s(65553),n=s(75535),l=s(62008);let o=(0,r.createContext)({user:null,role:null,loading:!0}),d=({children:e})=>{let[t,s]=(0,r.useState)(null),[d,c]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=(0,i.hg)(l.j,async e=>{if(s(e),e){let t=await (0,n.x7)((0,n.H9)(l.db,"Users",e.uid));t.exists()?c(t.data().role):c(null)}else c(null);m(!1)});return()=>e()},[]),(0,a.jsx)(o.Provider,{value:{user:t,role:d,loading:u},children:e})},c=()=>(0,r.useContext)(o)},84058:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(60687),r=s(43210),i=s(16189),n=s(75535),l=s(62008);function o({sessionId:e,onClose:t,onSaved:s}){let[i,o]=(0,r.useState)(""),[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[h,b]=(0,r.useState)(!1),g=async()=>{if(!i||!d||!u||!p)return alert("All fields required");b(!0);try{let a=(0,n.H9)(l.db,"Sessions",e);await (0,n.mZ)(a,{results:{durationMinutes:Number(i),durationSeconds:Number(d),engagementRating:Number(u),participationRating:Number(p),submittedAt:n.Dc.now()}}),t(),s?.()}catch(e){console.error("Error saving results:",e),alert("Failed to save results.")}finally{b(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Session Results"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsx)("input",{className:"border p-2",placeholder:"Minutes",value:i,onChange:e=>o(e.target.value),type:"number"}),(0,a.jsx)("input",{className:"border p-2",placeholder:"Seconds",value:d,onChange:e=>c(e.target.value),type:"number"})]}),(0,a.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"1–5: Engagement rating",value:u,onChange:e=>m(e.target.value),type:"number",min:1,max:5}),(0,a.jsx)("input",{className:"border p-2 w-full mb-4",placeholder:"1–5: Participation rating",value:p,onChange:e=>x(e.target.value),type:"number",min:1,max:5}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-400 rounded",onClick:()=>{o(""),c(""),m(""),x(""),t()},disabled:h,children:"Cancel"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:g,disabled:h,children:h?"Saving...":"Save"})]})]})})}function d({organisationId:e,roundId:t,sessionToEdit:s,onClose:i,onCompleted:o}){let[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[h,b]=(0,r.useState)(""),[g,v]=(0,r.useState)([]),f=(e,t,s)=>{let a=[...g];a[e][t]=s,v(a)},j=e=>{let t=[...g];t.splice(e,1),v(t)},N=async()=>{try{let a=s?.id||"",r=s?.teamId||"";a?await (0,n.mZ)((0,n.H9)(l.db,"Sessions",a),{date:d,startTime:u,facilitatorName:p}):a=(await (0,n.gS)((0,n.rJ)(l.db,"Sessions"),{orgId:e,roundId:t,date:d,startTime:u,facilitatorName:p,teamId:""})).id,r?(await (0,n.mZ)((0,n.H9)(l.db,"Teams",r),{teamName:h}),await (0,n.mZ)((0,n.H9)(l.db,"Sessions",a),{teamName:h})):(r=(await (0,n.gS)((0,n.rJ)(l.db,"Teams"),{orgId:e,roundId:t,sessionId:a,teamName:h})).id,await (0,n.mZ)((0,n.H9)(l.db,"Sessions",a),{teamId:r,teamName:h}));let i=(0,n.P)((0,n.rJ)(l.db,"TeamMembers"),(0,n._M)("teamId","==",r)),c=(await (0,n.GG)(i)).docs.map(e=>e.id),m=g.filter(e=>e.id).map(e=>e.id);for(let e of c.filter(e=>!m.includes(e)))await (0,n.kd)((0,n.H9)(l.db,"TeamMembers",e));for(let e of g){let t={teamId:r,firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",mobile:e.mobile||"",isLeader:e.isLeader??!1,attended:e.attended??!1,certified:e.certified??!1};e.id?await (0,n.mZ)((0,n.H9)(l.db,"TeamMembers",e.id),t):await (0,n.gS)((0,n.rJ)(l.db,"TeamMembers"),t)}await (0,n.mZ)((0,n.H9)(l.db,"Sessions",a),{teamMembersCount:g.length}),o()}catch(e){console.error("Failed to save session:",e)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-2xl overflow-y-auto max-h-screen",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-4",children:[s?"Edit":"Create"," Session"]}),(0,a.jsx)("input",{className:"border p-2 w-full mb-3",type:"date",value:d,onChange:e=>c(e.target.value)}),(0,a.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Start Time (HH:mm)",value:u,onChange:e=>m(e.target.value)}),(0,a.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Facilitator Name",value:p,onChange:e=>x(e.target.value)}),(0,a.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Team Name",value:h,onChange:e=>b(e.target.value)}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Team Members"}),g.map((e,t)=>(0,a.jsxs)("div",{className:"mb-2 grid grid-cols-4 gap-2 items-center",children:[(0,a.jsx)("input",{className:"border p-2",placeholder:"First Name",value:e.firstName,onChange:e=>f(t,"firstName",e.target.value)}),(0,a.jsx)("input",{className:"border p-2",placeholder:"Last Name",value:e.lastName||"",onChange:e=>f(t,"lastName",e.target.value)}),(0,a.jsx)("input",{className:"border p-2",placeholder:"Email",value:e.email,onChange:e=>f(t,"email",e.target.value)}),(0,a.jsx)("input",{className:"border p-2",placeholder:"Mobile",value:e.mobile||"",onChange:e=>f(t,"mobile",e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-2 items-center col-span-4",children:[(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",checked:e.isLeader??!1,onChange:e=>f(t,"isLeader",e.target.checked)})," Leader"]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",checked:e.attended??!1,onChange:e=>f(t,"attended",e.target.checked)})," Present"]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",checked:e.certified??!1,onChange:e=>f(t,"certified",e.target.checked)})," Certified"]}),(0,a.jsx)("button",{onClick:()=>j(t),className:"text-red-600 hover:underline",title:"Remove",children:"✖"})]})]},t)),(0,a.jsx)("button",{onClick:()=>{v([...g,{firstName:"",lastName:"",email:"",mobile:"",isLeader:!1,attended:!1,certified:!1}])},className:"mt-2 px-3 py-1 bg-blue-500 text-white rounded",children:"➕ Add Team Member"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-400 rounded",onClick:i,children:"Cancel"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:N,children:s?"Update":"Save"})]})]})})}var c=s(83606);function u({organisationId:e,roundToEdit:t,onClose:s,onCompleted:i}){let[o,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[h,b]=(0,r.useState)("Australia/Brisbane"),[g,v]=(0,r.useState)(""),[f,j]=(0,r.useState)([]),[N,w]=(0,r.useState)([]),[y,C]=(0,r.useState)(""),[P,S]=(0,r.useState)(""),[D,k]=(0,r.useState)(""),{role:I,loading:A}=(0,c.A)(),z=async()=>{if(!u||!p)return void v("Start and end dates are required.");try{let a=n.Dc.fromDate(new Date(u)),r=n.Dc.fromDate(new Date(p)),d={organisationId:e,roundName:o||`${u} Round`,startDate:a,endDate:r,status:"active",gameId:y||null,preQuizId:P||null,postQuizId:D||null,timezone:h};if(t){let e=(0,n.H9)(l.db,"Rounds",t.id);await (0,n.mZ)(e,d)}else await (0,n.gS)((0,n.rJ)(l.db,"Rounds"),d);i(),s()}catch(e){console.error(e),v("Failed to save round.")}};return A?null:I&&["super-admin","company-admin","org-manager"].includes(I)?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:t?"Edit Round":"Add New Round"}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Round Name (optional)"}),(0,a.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:o,onChange:e=>d(e.target.value)})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Start Date"}),(0,a.jsx)("input",{type:"date",className:"w-full p-2 border rounded",value:u,onChange:e=>m(e.target.value)})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"End Date"}),(0,a.jsx)("input",{type:"date",className:"w-full p-2 border rounded",value:p,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Timezone"}),(0,a.jsx)("select",{className:"w-full p-2 border rounded",value:h,onChange:e=>b(e.target.value),children:["Australia/Brisbane","Australia/Sydney","Australia/Melbourne","Australia/Perth","Australia/Adelaide","Australia/Darwin","Australia/Hobart"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Select Game"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded",value:y,onChange:e=>C(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"None"}),f.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Select Pre-Game Quiz"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded",value:P,onChange:e=>S(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"None"}),N.filter(e=>"Pre"===e.type).map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Select Post-Game Quiz"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded",value:D,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"None"}),N.filter(e=>"Post"===e.type).map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),g&&(0,a.jsx)("div",{className:"text-red-600 text-sm mb-3",children:g}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-200 rounded",onClick:s,children:"Cancel"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-orange-500 text-white font-bold rounded",onClick:z,children:t?"Update":"Save"})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Permission Denied"}),(0,a.jsx)("p",{className:"mb-4",children:"You do not have permission to manage rounds."}),(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-200 rounded",onClick:s,children:"Close"})]})})}function m({label:e,round:t,sessions:s,openSessionModal:r,openEditSessionModal:i,handleShowResults:n,handleEditRound:l,openTeamMembersModal:o}){let d=s.filter(e=>e.roundId===t.id);return(0,a.jsxs)("div",{className:"bg-white shadow p-4 rounded mt-4 border border-black",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:t.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[t.startDate," – ",t.endDate]}),(0,a.jsxs)("div",{className:"mt-1 text-sm text-gray-600 flex space-x-4 gap-2",children:[(0,a.jsxs)("p",{children:["\uD83C\uDFAE Game: ",t.gameName||"No Game Assigned"]}),(0,a.jsxs)("p",{children:["\uD83D\uDCDD Pre-Quiz: ",t.preQuizTitle||"None"]}),(0,a.jsxs)("p",{children:["\uD83D\uDCDD Post-Quiz: ",t.postQuizTitle||"None"]})]})]}),(0,a.jsxs)("div",{className:"space-x-2 flex items-center",children:["\uD83D\uDCDC Past Rounds"!==e&&(0,a.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 text-xl",title:"Add Session",children:"➕"}),(0,a.jsx)("button",{onClick:()=>l(t),className:"text-yellow-600 text-xl",title:"Edit Round",children:"✏️"}),(0,a.jsx)("a",{href:`/scoreboard/${t.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 text-xl",title:"Leaderboard",children:"\uD83C\uDFC6"})]})]}),(0,a.jsxs)("ul",{className:"mt-3 space-y-2",children:[d.map(e=>(0,a.jsxs)("li",{className:"border p-3 rounded flex justify-between items-center bg-gray-50 text-sm text-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-semibold",children:["\uD83D\uDCC5 ",e.date," at ",e.startTime]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4 mt-1",children:[(0,a.jsxs)("div",{children:["\uD83C\uDFF7️ Team: ",e.teamName||"Unnamed Team"]}),(0,a.jsxs)("div",{children:["\uD83D\uDC68‍\uD83D\uDCBC Facilitator: ",e.facilitatorName||"Not Assigned"]}),(0,a.jsxs)("p",{className:"text-blue-600 underline cursor-pointer",onClick:()=>o(e.teamId||"",e.id,t.gameId||""),children:["Members: ",e.teamMembersCount]})]}),(0,a.jsx)("div",{})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"text-blue-600 text-lg",onClick:()=>i(e),title:"Edit Session",children:"✏️"}),(0,a.jsx)("button",{className:"text-green-600 text-lg",onClick:()=>n(e.id),title:"View Results",children:"\uD83D\uDCCA"})]})]},e.id)),0===d.length&&(0,a.jsx)("li",{className:"text-gray-500 italic text-center mt-2",children:"No sessions added for this round yet."})]})]})}let p=(e,t,s)=>{let a=window.location.origin;return`${a}/quiz/${e}/${t}/${s}`},x=(e,t,s)=>{let a=p(e,t,s);window.open(a,"_blank")};function h({members:e,sessionId:t,gameId:s,onClose:r}){return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-lg overflow-y-auto max-h-screen",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Team Members"}),(0,a.jsx)("div",{className:"space-y-4",children:e.map((e,s)=>(0,a.jsx)("div",{className:"border p-4 rounded bg-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold",children:[e.firstName," ",e.lastName," ",e.isLeader&&"⭐"]}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:e.email})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"text-blue-600 hover:underline",onClick:()=>x("pre",t,e.id||""),children:"Pre-Quiz"}),(0,a.jsx)("button",{className:"text-green-600 hover:underline",onClick:()=>x("post",t,e.id||""),children:"Post-Quiz"})]})]})},s))}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-400 rounded",onClick:r,children:"Close"})})]})})}function b(){let{id:e}=(0,i.useParams)(),[t,s]=(0,r.useState)(null),[c,p]=(0,r.useState)([]),[x,b]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),[f,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[y,C]=(0,r.useState)(null),[P,S]=(0,r.useState)(!1),[D,k]=(0,r.useState)(null),[I,A]=(0,r.useState)(!1),[z,R]=(0,r.useState)(null),[_,M]=(0,r.useState)(!1),[T,q]=(0,r.useState)([]),[E,Q]=(0,r.useState)(""),[G,H]=(0,r.useState)(""),U=async()=>{if(!e)return;let t=(0,n.H9)(l.db,"Organisations",String(e)),a=await (0,n.x7)(t);if(a.exists()){let e=a.data();s({id:a.id,organisationName:e.organisationName})}let r=(0,n.P)((0,n.rJ)(l.db,"Rounds"),(0,n._M)("organisationId","==",e)),i=await (0,n.GG)(r);p(await Promise.all(i.docs.map(async e=>{let t=e.data(),s=t.startDate instanceof n.Dc?t.startDate.toDate():new Date,a=t.endDate instanceof n.Dc?t.endDate.toDate():new Date,r=t.gameId?await (0,n.x7)((0,n.H9)(l.db,"Games",t.gameId)):null,i=t.preQuizId?await (0,n.x7)((0,n.H9)(l.db,"Quizzes",t.preQuizId)):null,o=t.postQuizId?await (0,n.x7)((0,n.H9)(l.db,"Quizzes",t.postQuizId)):null;return{id:e.id,name:t.roundName,startDate:s.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0],gameId:t.gameId||"",preQuizId:t.preQuizId||"",postQuizId:t.postQuizId||"",gameName:r?.data()?.name||"N/A",preQuizTitle:i?.data()?.title||"N/A",postQuizTitle:o?.data()?.title||"N/A"}})));let o=(0,n.P)((0,n.rJ)(l.db,"Sessions"),(0,n._M)("orgId","==",e));b((await (0,n.GG)(o)).docs.map(e=>{let t=e.data();return{id:e.id,date:t.date,startTime:t.startTime,teamName:t.teamName||"",facilitatorName:t.facilitatorName,teamMembersCount:t.teamMembersCount||0,teamId:t.teamId,roundId:t.roundId||"",results:t.results||void 0}})),v(!1)},{active:L,upcoming:F,past:J}=(()=>{let e=new Date,t=[],s=[],a=[];return c.forEach(r=>{let i=new Date(r.startDate),n=new Date(r.endDate);i<=e&&n>=e?t.push(r):i>e?s.push(r):a.push(r)}),{active:t,upcoming:s,past:a}})(),Z=e=>{C(e),w(null),j(!0)},O=e=>{C(c.find(t=>t.id===e.roundId)||null),w(e),j(!0)},$=e=>{k(e),S(!0)},Y=e=>{R(e),A(!0)},B=async(e,t,s)=>{if(!e){q([]),Q(t),H(s),M(!0);return}let a=(0,n.P)((0,n.rJ)(l.db,"TeamMembers"),(0,n._M)("teamId","==",e));q((await (0,n.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))),Q(t),H(s),M(!0)};return g||!t?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:t.organisationName}),(0,a.jsx)("button",{className:"bg-orange-500 hover:bg-yellow-400 text-black font-bold px-4 py-2 rounded transition",onClick:()=>{k(null),S(!0)},children:"➕ Add Round"})]}),[["\uD83D\uDD25 Active Round",L],["\uD83D\uDCC5 Upcoming Rounds",F],["\uD83D\uDCDC Past Rounds",J]].map(([e,t])=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mt-6",children:e}),t.map(t=>(0,a.jsx)(m,{label:e,round:t,sessions:x,openSessionModal:()=>Z(t),openEditSessionModal:O,handleEditRound:()=>$(t),handleShowResults:Y,openTeamMembersModal:B},t.id))]},e)),P&&(0,a.jsx)(u,{organisationId:t.id,roundToEdit:D||void 0,onClose:()=>{S(!1),k(null)},onCompleted:()=>{S(!1),k(null),U()}}),f&&(0,a.jsx)(d,{organisationId:t.id,roundId:y?.id||"",sessionToEdit:N||void 0,onClose:()=>{j(!1),w(null)},onCompleted:()=>{j(!1),w(null),U()}}),I&&z&&(0,a.jsx)(o,{sessionId:z,onClose:()=>{A(!1),R(null)},onSaved:()=>{A(!1),R(null),U()}}),_&&(0,a.jsx)(h,{members:T,sessionId:E,gameId:G,onClose:()=>M(!1)})]})}},84061:(e,t,s)=>{Promise.resolve().then(s.bind(s,86512))},86512:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/craigparker/Development/projects/escape_portal/src/app/admin-portal/layout.tsx","default")},91123:(e,t,s)=>{Promise.resolve().then(s.bind(s,84058))},91645:e=>{"use strict";e.exports=require("net")},92133:(e,t,s)=>{Promise.resolve().then(s.bind(s,22932))},94431:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>i});var a=s(37413);s(61135);var r=s(22932);let i={title:"Escape Portal",description:"Cyber escape game admin portal"};function n({children:e}){return(0,a.jsx)("html",{lang:"en",children:(0,a.jsx)("body",{className:"bg-black text-white",children:(0,a.jsx)(r.AuthProvider,{children:e})})})}},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[447,839,658,814,474],()=>s(49903));module.exports=a})();