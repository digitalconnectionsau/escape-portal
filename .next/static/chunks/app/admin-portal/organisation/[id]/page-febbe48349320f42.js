(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[412],{412:(e,a,t)=>{"use strict";t.d(a,{db:()=>d,j:()=>i});var s=t(3915),n=t(6203),r=t(5317);let l=(0,s.Wp)({apiKey:"AIzaSyDD6coY49gQGo7rkhcPQY6nUhftziODTPY",authDomain:"escape-portal-au.firebaseapp.com",projectId:"escape-portal-au",storageBucket:"escape-portal-au.firebasestorage.app",messagingSenderId:"917308365081",appId:"1:917308365081:web:1fb93c63b2b43ad9678d88",measurementId:"G-LQ50CD3219"}),i=(0,n.xI)(l),d=(0,r.aU)(l)},5695:(e,a,t)=>{"use strict";var s=t(8999);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},7421:(e,a,t)=>{Promise.resolve().then(t.bind(t,8249))},8249:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var s=t(5155),n=t(2115),r=t(5695),l=t(5317),i=t(412);function d(e){let{sessionId:a,onClose:t,onSaved:r}=e,[d,u]=(0,n.useState)(""),[o,m]=(0,n.useState)(""),[c,x]=(0,n.useState)(""),[p,b]=(0,n.useState)(""),[h,g]=(0,n.useState)(!1),N=async()=>{if(!d||!o||!c||!p)return alert("All fields required");g(!0);try{let e=(0,l.H9)(i.db,"Sessions",a);await (0,l.mZ)(e,{results:{durationMinutes:Number(d),durationSeconds:Number(o),engagementRating:Number(c),participationRating:Number(p),submittedAt:l.Dc.now()}}),t(),null==r||r()}catch(e){console.error("Error saving results:",e),alert("Failed to save results.")}finally{g(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Session Results"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsx)("input",{className:"border p-2",placeholder:"Minutes",value:d,onChange:e=>u(e.target.value),type:"number"}),(0,s.jsx)("input",{className:"border p-2",placeholder:"Seconds",value:o,onChange:e=>m(e.target.value),type:"number"})]}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"1–5: Engagement rating",value:c,onChange:e=>x(e.target.value),type:"number",min:1,max:5}),(0,s.jsx)("input",{className:"border p-2 w-full mb-4",placeholder:"1–5: Participation rating",value:p,onChange:e=>b(e.target.value),type:"number",min:1,max:5}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-4 py-2 bg-gray-400 rounded",onClick:()=>{u(""),m(""),x(""),b(""),t()},disabled:h,children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:N,disabled:h,children:h?"Saving...":"Save"})]})]})})}function u(){let{id:e}=(0,r.useParams)(),[a,t]=(0,n.useState)(null),[u,o]=(0,n.useState)(!0),[m,c]=(0,n.useState)([]),[x,p]=(0,n.useState)([]),[b,h]=(0,n.useState)(!1),[g,N]=(0,n.useState)(null),[f,j]=(0,n.useState)(""),[v,S]=(0,n.useState)(""),[w,D]=(0,n.useState)(""),[C,y]=(0,n.useState)(""),[I,k]=(0,n.useState)([{firstName:"",email:""}]),[P,R]=(0,n.useState)(null),[M,T]=(0,n.useState)([]),[G,E]=(0,n.useState)([]),[F,A]=(0,n.useState)([]),[_,J]=(0,n.useState)(""),[O,z]=(0,n.useState)(""),H=async()=>{let a=(0,l.H9)(i.db,"Organisations",String(e)),s=await (0,l.x7)(a);if(c((await (0,l.GG)((0,l.rJ)(i.db,"Games"))).docs.map(e=>({id:e.id,name:e.data().name}))),s.exists()){let e=s.data(),n=(0,l.rJ)(a,"Rounds"),r=(await (0,l.GG)(n)).docs.map(e=>{let a=e.data(),t=a.startDate instanceof l.Dc?a.startDate.toDate():new Date,s=a.endDate instanceof l.Dc?a.endDate.toDate():new Date;return{id:e.id,name:a.roundName,startDate:t.toISOString().split("T")[0],endDate:s.toISOString().split("T")[0],gameId:a.gameId||""}});t({id:s.id,organisationName:e.organisationName,rounds:r})}let n=await (0,l.GG)((0,l.rJ)(i.db,"Sessions"));p(await Promise.all(n.docs.map(async e=>{let a=e.data(),t=0;return a.teamId&&(t=(await (0,l.GG)((0,l.P)((0,l.rJ)(i.db,"TeamMembers"),(0,l._M)("teamId","==",a.teamId)))).size),{id:e.id,date:a.date,startTime:a.startTime,teamName:a.teamName||"",facilitatorName:a.facilitatorName,teamMembersCount:t,teamId:a.teamId,roundId:a.roundId||"",results:a.results||void 0}}))),o(!1)};(0,n.useEffect)(()=>{H()},[e]);let L=(e,a,t)=>{let s=[...I];s[e][a]=t,k(s)},U=e=>{let a=I[e];a.id&&T(e=>[...e,a.id]),I.length>1&&k(I.filter((a,t)=>t!==e))},Q=e=>{R(null),N(e),h(!0),j(""),S(""),D(""),y(""),k([{firstName:"",email:""}]),T([])},Y=async e=>{R(e),N((null==a?void 0:a.rounds.find(a=>a.id===e.roundId))||null),j(e.date),S(e.startTime),D(e.facilitatorName),y(e.teamName),T([]),k((await (0,l.GG)((0,l.P)((0,l.rJ)(i.db,"TeamMembers"),(0,l._M)("teamId","==",e.teamId)))).docs.map(e=>({id:e.id,...e.data()}))),h(!0)},Z=async()=>{if(f&&v&&C&&w&&g){if(P){let a=(0,l.H9)(i.db,"Sessions",P.id),t=(0,l.H9)(i.db,"Teams",P.teamId);for(let e of(await (0,l.mZ)(a,{date:f,startTime:v,facilitatorName:w,teamName:C,roundId:g.id}),await (0,l.mZ)(t,{teamName:C,roundId:g.id}),M))await (0,l.kd)((0,l.H9)(i.db,"TeamMembers",e));let s=I.filter(e=>e.firstName&&e.email&&!e.id);await Promise.all(s.map(a=>(0,l.gS)((0,l.rJ)(i.db,"TeamMembers"),{...a,teamId:P.teamId,orgId:e,roundId:g.id,sessionDate:f,joinedAt:new Date})))}h(!1),await H()}},[q,B]=(0,n.useState)(!1),[K,W]=(0,n.useState)(null);if(u||!a)return(0,s.jsx)("div",{children:"Loading..."});let{active:V,upcoming:X,past:$}=(e=>{let a=new Date,t=[],s=[],n=[];return e.forEach(e=>{let r=new Date(e.startDate),l=new Date(e.endDate);r<=a&&l>=a?t.push(e):r>a?s.push(e):n.push(e)}),{active:t,upcoming:s,past:n}})(a.rounds);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:a.organisationName}),(0,s.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>alert("Add round modal coming soon"),children:"➕ Add Round"})]}),[["\uD83D\uDD25 Active Round",V],["\uD83D\uDCC5 Upcoming Rounds",X],["\uD83D\uDCDC Past Rounds",$]].map(e=>{let[a,t]=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mt-6",children:a}),t.map(e=>{var t;return(0,s.jsxs)("div",{className:"bg-white shadow p-4 rounded mt-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold",children:[e.name," (",e.startDate," – ",e.endDate,")"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Game: ",(null==(t=m.find(a=>a.id===e.gameId))?void 0:t.name)||"None assigned"]})]}),(0,s.jsxs)("div",{className:"space-x-2",children:["\uD83D\uDCDC Past Rounds"!==a&&(0,s.jsx)("button",{onClick:()=>Q(e),className:"bg-blue-600 text-white px-2 py-1 rounded",children:"➕ Add Session"}),(0,s.jsx)("button",{onClick:()=>alert("Edit round"),className:"text-blue-600",children:"✏️ Edit"}),(0,s.jsx)("a",{href:"/scoreboard/".concat(e.id),target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"\uD83C\uDFC6 Leaderboard"})]})]}),(0,s.jsx)("ul",{className:"mt-3 space-y-1",children:x.filter(a=>a.roundId===e.id).map(e=>(0,s.jsxs)("li",{className:"border p-2 rounded flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:e.date})," at ",e.startTime," — ",e.teamName," (Facilitator: ",e.facilitatorName,")",(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["Members: ",e.teamMembersCount]}),e.results&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-xs text-green-600",children:["\uD83D\uDD52 Duration: ",e.results.durationMinutes,"m ",e.results.durationSeconds,"s"]}),(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-xs text-blue-600",children:["\uD83C\uDF1F Engagement: ",e.results.engagementRating,"/10 \xb7 Participation: ",e.results.participationRating,"/10"]}),(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-xs text-purple-600 font-semibold",children:["\uD83C\uDFC5 Score: ",(()=>{let a=e.results.durationMinutes,t=Math.max(0,600-(60*a+e.results.durationSeconds)/1800*600);return parseFloat((.1*t+e.results.engagementRating/10*20+e.results.participationRating/10*20).toFixed(1))})()]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"text-sm text-blue-600 hover:underline",onClick:()=>Y(e),children:"✏️ Edit"}),(0,s.jsx)("button",{className:"text-sm text-green-600 hover:underline",onClick:()=>{W(e.id),B(!0)},children:"\uD83D\uDCCA Results"})]})]},e.id))})]},e.id)})]},a)}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-2xl",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-4",children:[P?"Edit":"Create"," Session"]}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",type:"date",value:f,onChange:e=>j(e.target.value)}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Start Time",value:v,onChange:e=>S(e.target.value)}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Facilitator Name",value:w,onChange:e=>D(e.target.value)}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Team Name",value:C,onChange:e=>y(e.target.value)}),(0,s.jsxs)("h3",{className:"font-semibold mb-2",children:["Team Members (",I.length,"/18)"]}),I.map((e,a)=>(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-2 items-center",children:[(0,s.jsx)("input",{className:"border p-2",placeholder:"First Name*",value:e.firstName,onChange:e=>L(a,"firstName",e.target.value)}),(0,s.jsx)("input",{className:"border p-2",placeholder:"Last Name",value:e.lastName||"",onChange:e=>L(a,"lastName",e.target.value)}),(0,s.jsx)("input",{className:"border p-2",placeholder:"Email*",value:e.email,onChange:e=>L(a,"email",e.target.value)}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{className:"border p-2 w-full",placeholder:"Mobile",value:e.mobile||"",onChange:e=>L(a,"mobile",e.target.value)}),I.length>1&&(0,s.jsx)("button",{onClick:()=>U(a),className:"ml-2 text-red-500 text-sm",children:"\uD83D\uDDD1️"})]})]},a)),I.length<18&&(0,s.jsx)("button",{onClick:()=>{I.length<18&&k([...I,{firstName:"",email:""}])},className:"text-blue-600 text-sm mb-4",children:"➕ Add Member"}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-4 py-2 bg-gray-400 rounded",onClick:()=>h(!1),children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:Z,children:P?"Update":"Save"})]})]})}),q&&K&&(0,s.jsx)(d,{sessionId:K,onClose:()=>{B(!1),W(null)},onSaved:H})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,118,645,441,684,358],()=>a(7421)),_N_E=e.O()}]);