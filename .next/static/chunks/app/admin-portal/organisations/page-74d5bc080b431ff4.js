(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{412:(e,a,t)=>{"use strict";t.d(a,{db:()=>d,j:()=>i});var s=t(3915),l=t(6203),n=t(5317);let r=(0,s.Wp)({apiKey:"AIzaSyDD6coY49gQGo7rkhcPQY6nUhftziODTPY",authDomain:"escape-portal-au.firebaseapp.com",projectId:"escape-portal-au",storageBucket:"escape-portal-au.firebasestorage.app",messagingSenderId:"917308365081",appId:"1:917308365081:web:1fb93c63b2b43ad9678d88",measurementId:"G-LQ50CD3219"}),i=(0,l.xI)(r),d=(0,n.aU)(r)},6227:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>x});var s=t(5155),l=t(2115),n=t(5317),r=t(412),i=t(6874),d=t.n(i),o=t(6203);function c(e){let{onClose:a,onCreated:t}=e,[i,d]=(0,l.useState)(""),[c,x]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[N,j]=(0,l.useState)(null),[f,y]=(0,l.useState)(!1),[w,v]=(0,l.useState)(""),S=async()=>{if(h){y(!0),v("");try{let e=(0,n.P)((0,n.rJ)(r.db,"Users"),(0,n._M)("email","==",h)),a=await (0,n.GG)(e);a.empty?j(null):j(a.docs[0])}catch(e){v("Error checking email.")}finally{y(!1)}}},k=async()=>{try{let e="";e=N?N.id:(await (0,o.eJ)(r.j,h,g)).user.uid;let s=await (0,n.gS)((0,n.rJ)(r.db,"Organisations"),{organisationName:i,organisationAdminId:e,status:"active"});N?await (0,n.mZ)((0,n.H9)(r.db,"Users",e),{organisationId:s.id}):await (0,n.BN)((0,n.H9)(r.db,"Users",e),{uid:e,firstName:c,lastName:m,email:h,role:"company-admin",organisationId:s.id}),null==t||t(),a()}catch(e){console.error(e),v("Failed to create organisation.")}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Add New Organisation"}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Organisation Name"}),(0,s.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:i,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"First Name"}),(0,s.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:c,onChange:e=>x(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Last Name"}),(0,s.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:m,onChange:e=>u(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Email"}),(0,s.jsx)("input",{type:"email",className:"w-full p-2 border rounded",value:h,onChange:e=>p(e.target.value),onBlur:S})]}),!N&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Password"}),(0,s.jsx)("input",{type:"password",className:"w-full p-2 border rounded",value:g,onChange:e=>b(e.target.value)})]}),N&&(0,s.jsx)("div",{className:"text-green-700 text-sm mb-3",children:"User already exists and will be linked."}),w&&(0,s.jsx)("div",{className:"text-red-600 text-sm mb-3",children:w}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-4 py-2 bg-gray-200 rounded",onClick:a,children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-orange-500 text-white font-bold rounded",onClick:k,children:"Save"})]})]})})}function x(){let[e,a]=(0,l.useState)([]),[t,i]=(0,l.useState)(!1),[o,x]=(0,l.useState)([]),[m,u]=(0,l.useState)([]),[h,p]=(0,l.useState)([]),g=async()=>{try{let e=(await (0,n.GG)((0,n.rJ)(r.db,"Organisations"))).docs.map(e=>({id:e.id,...e.data()}));a(e);let t=[];for(let a of e){let e=(await (0,n.GG)((0,n.rJ)(r.db,"Organisations",a.id,"Rounds"))).docs.map(e=>({id:e.id,orgId:a.id,...e.data()}));t.push(...e)}x(t);let s=(await (0,n.GG)((0,n.rJ)(r.db,"Sessions"))).docs.map(e=>({id:e.id,...e.data()}));u(s);let l=(await (0,n.GG)((0,n.rJ)(r.db,"Users"))).docs.map(e=>({id:e.id,...e.data()}));p(l)}catch(e){console.error("Error fetching organisations:",e)}};(0,l.useEffect)(()=>{g()},[]);let b=e=>{let a=h.find(a=>a.id===e);return a?a.firstName:"—"},N=e=>{let a=new Date,t=o.find(t=>t.orgId===e&&t.startDate.toDate()<=a&&t.endDate.toDate()>=a);return t?t.roundName.slice(0,8):"—"},j=e=>{let a=new Date().toISOString();return m.filter(t=>t.orgId===e&&t.date>=a).length},f=e=>{let a=new Date().toISOString();return m.filter(t=>t.orgId===e&&t.date<a).length};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-black",children:"Organisations"}),(0,s.jsx)("button",{className:"bg-orange-500 hover:bg-yellow-400 text-black font-bold px-4 py-2 rounded transition",onClick:()=>i(!0),children:"➕ New Organisation"})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-2xl shadow-lg",children:(0,s.jsxs)("table",{className:"w-full bg-black text-white",children:[(0,s.jsx)("thead",{className:"bg-gray-800",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Organisation Name"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Primary Contact"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Current Round"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Sessions Upcoming"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Sessions Completed"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Scoreboard"}),(0,s.jsx)("th",{className:"text-left px-6 py-3",children:"Manage"})]})}),(0,s.jsx)("tbody",{children:e.length>0?e.map(e=>(0,s.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)(d(),{href:"/admin-portal/organisation/".concat(e.id),className:"text-orange-400 hover:text-yellow-400 underline",children:e.organisationName})}),(0,s.jsx)("td",{className:"px-6 py-4",children:b(e.organisationAdminId)}),(0,s.jsx)("td",{className:"px-6 py-4",children:N(e.id)}),(0,s.jsx)("td",{className:"px-6 py-4",children:j(e.id)}),(0,s.jsx)("td",{className:"px-6 py-4",children:f(e.id)}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)(d(),{href:"/scoreboard/".concat(e.id),className:"text-orange-400 hover:text-yellow-400 underline",children:"View"})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)(d(),{href:"/admin-portal/organisation/".concat(e.id),className:"text-orange-400 hover:text-yellow-400 text-2xl",title:"Manage Organisation",children:"⚙️"})})]},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:8,className:"text-center px-6 py-6 text-gray-400",children:"No organisations found."})})})]})}),t&&(0,s.jsx)(c,{onClose:()=>i(!1),onCreated:()=>{i(!1),g()}})]})}},7192:(e,a,t)=>{Promise.resolve().then(t.bind(t,6227))}},e=>{var a=a=>e(e.s=a);e.O(0,[992,118,645,874,441,684,358],()=>a(7192)),_N_E=e.O()}]);